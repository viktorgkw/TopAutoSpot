@page
@using Microsoft.EntityFrameworkCore;
@using TopAutoSpot.Data;
@using TopAutoSpot.Data.Entities.Utilities;
@inject UserManager<User> UserManager
@model TopAutoSpot.Data.Entities.Listing

@{
    ViewData["Title"] = "Create Listing";

    // This is a test. The code won't be used for production!

    var foundUser = UserManager.Users.First(u => u.UserName == User.Identity.Name);

    var optionsBuilder = new DbContextOptionsBuilder<ApplicationDbContext>()
        .UseSqlServer(ConnectionStringStaticClass.ConnectionString);

    var db = new ApplicationDbContext(optionsBuilder.Options);

    var cars = db.Cars.Where(car => car.CreatedBy == foundUser.Id).ToList();
    var buses = db.Buses.Where(bus => bus.CreatedBy == foundUser.Id).ToList();
    var boats = db.Boats.Where(boat => boat.CreatedBy == foundUser.Id).ToList();
    var motorcycles = db.Motorcycles.Where(motorcycle => motorcycle.CreatedBy == foundUser.Id).ToList();
    var trailers = db.Trailers.Where(trailer => trailer.CreatedBy == foundUser.Id).ToList();
    var trucks = db.Trucks.Where(truck => truck.CreatedBy == foundUser.Id).ToList();

    int vehiclesCount = cars.Count + buses.Count +
        boats.Count + motorcycles.Count +
        trailers.Count + trucks.Count;

    bool hasAnyVehicles = vehiclesCount > 0;
}

<h1 class="fw-bold text-info">Create Listing</h1>
<hr />

<div class="row">
    <div class="col-md-4 mx-auto">
        <form asp-action="CreateListing">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            @*Id must be auto-generated!*@

            @*VehicleId must be a drop-down menu with the User's Vehicles List!*@
            <div class="form-group">
                <label asp-for="VehicleId" class="control-label fw-bold text-secondary fs-4"></label>
                @if (hasAnyVehicles == false)
                {
                    <p class="fw-bold text-danger fs-6">You don't have any vehicles!</p>
                }
                else
                {
                    <select multiple class="form-control" id="exampleFormControlSelect2">
                        @foreach (var car in cars)
                        {
                            <option>@car.Id</option>
                        }
                        @foreach (var bus in buses)
                        {
                            <option>@bus.Id</option>
                        }
                        @foreach (var boat in boats)
                        {
                            <option>@boat.Id</option>
                        }
                        @foreach (var motor in motorcycles)
                        {
                            <option>@motor.Id</option>
                        }
                        @foreach (var trailer in trailers)
                        {
                            <option>@trailer.Id</option>
                        }
                        @foreach (var truck in trucks)
                        {
                            <option>@truck.Id</option>
                        }
                    </select>
                }
            </div>

            @*Category must be drop-down menu!*@
            <div class="form-group">
                <label asp-for="Category" class="control-label fw-bold text-secondary fs-4"></label>
                <input asp-for="Category" class="form-control text-center" />
                <span asp-validation-for="Category" class="text-danger"></span>
            </div>

            @*CreatedBy must be auto-generated!*@

            @*CreatedAt must be auto-generated!*@

            <div class="form-group">
                <label asp-for="Title" class="control-label fw-bold text-secondary fs-4"></label>
                <input asp-for="Title" class="form-control text-center" />
                <span asp-validation-for="Title" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Description" class="control-label fw-bold text-secondary fs-4"></label>
                <input asp-for="Description" class="form-control text-center" />
                <span asp-validation-for="Description" class="text-danger"></span>
            </div>
            <div class="form-group">
                <label asp-for="Price" class="control-label fw-bold text-secondary fs-4"></label>
                <input asp-for="Price" class="form-control text-center" />
                <span asp-validation-for="Price" class="text-danger"></span>
            </div>
            <div class="form-group">
                <input type="submit" value="Create" class="btn btn-outline-success fw-bold mt-4 mb-2" />
            </div>
        </form>
    </div>
</div>

<div class="mt-4 mb-4">
    <a class="btn btn-warning text-light fw-bold" asp-action="Index">Go Back</a>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
